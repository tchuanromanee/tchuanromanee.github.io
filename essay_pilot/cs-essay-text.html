<html>
    <head>
        <link href="css/annotator.css" rel="stylesheet" type="text/css">
    </head>
	<body>

        <script src="build/annotator.min.js" type="text/javascript"></script>
        <script src="js/annotatorExtra.js" type="text/javascript"></script>
        <script src="lib/jquery-1.8.2.js" type="text/javascript"></script>

        <script src="http://cdn.rawgit.com/DmitryBaranovskiy/raphael/master/raphael-min.js" type="text/javascript"></script>

        <section id = "essay">
          <p>
          Please select the 4 most important pieces of evidence below that help you evaluate this hypothesis.
          <br />Please rank the 4 that you select from most to least helpful.
          <br />Only 4 pieces of evidence are allowed to be selected.
        </p>
            <h2>Hypothesis:</h2>
            <p>
              This is a strong applicant.
            </p>
          <h2>Evidence</h2>
            <table cellpadding="10">
              <tbody>
                <tr>
                  <td>Top 4 evidence?</td>
                  <td>ID of evidence</td>
                  <td>Ranking of top 4</td>
                  <td>Measure of supportiveness (7) to non-supportiveness (1) of hypothesis</td>
                  <td>Evidence</td>
                </tr>
                <tr>
            			<td><input type="checkbox" id="optionA" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>a.</td>
            			<td><select disabled id ="rankingA" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Essay (Building Relationships): Upon our first meeting, she opened up about her two sons, her hometown, and her knitting group--no mention of her disease. Without even standing up, the three of us—Ivana, me, and my grandmother--had taken a walk together.
                  <br /><strong>OR:</strong> Essay (good sentence structure): Upon our first meeting, she opened up about her two sons, her hometown, and her knitting group--no mention of her disease. Without even standing up, the three of us—Ivana, me, and my grandmother--had taken a walk together.
                </td>
            		</tr>
                <tr>
            			<td><input type="checkbox" id="optionB" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>b.</td>
            			<td><select disabled id ="rankingB" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Essay (Gaining perspective): Cancer, as powerful and invincible as it may seem, is a mere fraction of a person’s life. It’s easy to forget when one’s mind and body are so weak and vulnerable.
                  <br /><strong>OR:</strong> Essay (Sentiment: Positive, 91.7%): Cancer, as powerful and invincible as it may seem, is a mere fraction of a person’s life. It’s easy to forget when one’s mind and body are so weak and vulnerable.
                </td>

              	</tr><tr>
            			<td><input type="checkbox" id="optionC" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>c.</td>
            			<td><select disabled id ="rankingC" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Essay (Showing initiative): Before I could resolve my guilt, I had to broaden my perspective of the world as well as my responsibilities to my fellow humans.
                  <br /><strong>OR:</strong> Essay (Emotion: anger, joy, sadness): Before I could resolve my guilt, I had to broaden my perspective of the world as well as my responsibilities to my fellow humans.
                </td>
                </tr>
                <tr>
            			<td><input type="checkbox" id="optionD" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>d.</td>
            			<td><select disabled id ="rankingD" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Test scores: The student has exceptional SAT test scores, scoring a 1540 out of 1600 points.</td>

                </tr>
                <tr>
            			<td><input type="checkbox" id="optionE" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>e.</td>
            			<td><select disabled id ="rankingE" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Classes Taken: The student's classes are a little less rigorous than their peers'.</td>
            		</tr>
                <tr>
            			<td><input type="checkbox" id="optionF" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>f.</td>
            			<td><select disabled id ="rankingF" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Extracurriculars: The student has volunteered in many different organizations but is not consistent, staying at each place for only a few months at a time. </td>
            		</tr>
                <tr>
            			<td><input type="checkbox" id="optionG" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>g.</td>
            			<td><select disabled id ="rankingG" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
                  <td>GPA: The student has a GPA of 3.35 of 4. This is a mediocre GPA for a student of this background and typical of students applying.</td>

            		</tr>
                <tr>
            			<td><input type="checkbox" id="optionH" name ="optionSelect" class ="evidenceSelection"/></td>
            			<td>h.</td>
            			<td><select disabled id ="rankingH" class ="rankingSelect">
                    <option value="1">1 (most helpful)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4 (least helpful)</option>
                  </select></td>
                  <td>6.5</td>
            			<td>Class Performance: The student should have taken more AP classes, since they have taken only 2 classes during all 4 years of high school.</td>
            		</tr>
            	</tbody>
            </table>
            <div>
             </div>
        </section>
        <section id ="continue">
          <p>
            Please make sure you have made your selections before submitting.
          </p>
        </section>
        <section id ="firstRate">
          Please rate the student.
          <ul class="likert">
            <li class="likert"> Very Weak <input id="firstRateStart" type="radio" name="firstRatingRadio" value="1" required/>
            <li class="likert"><input type="radio" name="firstRatingRadio" value="2" />
            <li class="likert"><input type="radio" name="firstRatingRadio" value="3" />
            <li class="likert"><input type="radio" name="firstRatingRadio" value="4" />
            <li class="likert"><input id="firstRateEnd" type="radio" name="firstRatingRadio" value="5" /> Very Strong
        </ul>
        <br />
        </section>
        <section id = "essayVis">
			       To un-highlight text, click on the highlighted portion again.
            <h2>Review Essay</h2>

            <div>
                <p style="display: inline">
                  They covered the precious mahogany coffin with a brown amalgam of rocks, decomposed organisms, and weeds. It was my turn to take the shovel, but I felt too ashamed to dutifully send her off when I had not properly said goodbye. I refused to throw dirt on her. I refused to let go of my grandmother, to accept a death I had not seen coming, to believe that an illness could not only interrupt, but steal a beloved life.
                </p>
                <p>
                When my parents finally revealed to me that my grandmother had been battling liver cancer, I was twelve and I was angry--mostly with myself. They had wanted to protect me--only six years old at the time--from the complex and morose concept of death. However, when the end inevitably arrived, I wasn’t trying to comprehend what dying was; I was trying to understand how I had been able to abandon my sick grandmother in favor of playing with friends and watching TV. Hurt that my parents had deceived me and resentful of my own oblivion, I committed myself to preventing such blindness from resurfacing.
                </p>
                <p>
                I became desperately devoted to my education because I saw knowledge as the key to freeing myself from the chains of ignorance. While learning about cancer in school I promised myself that I would memorize every fact and absorb every detail in textbooks and online medical journals. And as I began to consider my future, I realized that what I learned in school would allow me to silence that which had silenced my grandmother. However, I was focused not with learning itself, but with good grades and high test scores. I started to believe that academic perfection would be the only way to redeem myself in her eyes--to make up for what I had not done as a granddaughter.
                </p>
                <p>
                <div id="1" class="badevidence tooltip" onmouseover="showEvidence(this)" onmouseout="hideEvidence(this)">However, a simple walk on a hiking trail behind my house<span class="tooltiptext">Grammar problems!</span></div> made me open my own eyes to the truth. Over the years, everything--even honoring my grandmother--had become second to school and grades. As my shoes humbly tapped against the Earth, the towering trees blackened by the forest fire a few years ago, the faintly colorful pebbles embedded in the sidewalk, and the wispy white clouds hanging in the sky reminded me of my small though nonetheless significant part in a larger whole that is humankind and this Earth. Before I could resolve my guilt, I had to broaden my perspective of the world as well as my responsibilities to my fellow humans.
                </p>
                <p>
                Volunteering at a cancer treatment center has helped me discover my path. When I see patients trapped in not only the hospital but also a moment in time by their diseases, I talk to them. For six hours a day, three times a week, Ivana is surrounded by IV stands, empty walls, and busy nurses that quietly yet constantly remind her of her breast cancer. Her face is pale and tired, yet kind--not unlike my grandmother’s. I need only to smile and say hello to see her brighten up as life returns to her face. Upon our first meeting, she opened up about her two sons, her hometown, and her knitting group--no mention of her disease. Without even standing up, the three of us—Ivana, me, and my grandmother--had taken a walk together.
                </p>
                <p>
                Cancer, as powerful and invincible as it may seem, is a mere fraction of a person’s life. It’s easy to forget when one’s mind and body are so weak and vulnerable. I want to be there as an oncologist to remind them to take a walk once in a while, to remember that there’s so much more to life than a disease. While I physically treat their cancer, I want to lend patients emotional support and mental strength to escape the interruption and continue living. Through my work, I can accept the shovel without burying my grandmother’s memory.
                </p>
             </div>
             <div id="3" class="tooltip"><img src="img/Difficulty-85-green.svg"><span class="tooltiptext">This is an okay score for someone at this level</span></div> <br />
             <div id="4" class="tooltip"><img src="img/Sentiment-positive.svg"><span class="tooltiptext">A positive sentiment</span></div><br />
             <div id="5" class="tooltip"><img src="img/Emotion-Surprise-orange.svg"><span class="tooltiptext">Score of 0.019</span></div><br />
             <div id="6" class="tooltip"><img src="img/Emotion-Joy-blue.svg"><span class="tooltiptext">Score of 0.005</span></div><br />

        </section>
        <section id ="secondRate">
          Please rate the student.
          <ul class="likert">
            <li class="likert"> Very Weak <input id="secondRateStart" type="radio" name="secondRatingRadio" value="1" required/>
            <li class="likert"><input type="radio" name="secondRatingRadio" value="2" />
            <li class="likert"><input type="radio" name="secondRatingRadio" value="3" />
            <li class="likert"><input type="radio" name="secondRatingRadio" value="4" />
            <li class="likert"><input id="secondRateEnd" type="radio" name="secondRatingRadio" value="5" /> Very Strong
        </ul>
        <br />
        </section>
        <second id ="finished">
          Finished!
        </section>
        <script src='https://cdn.rawgit.com/timdown/rangy/master/lib/rangy-core.js' type="text/javascript"></script>
        <script src='https://cdn.rawgit.com/timdown/rangy/master/lib/rangy-classapplier.js' type="text/javascript"></script>
        <script type="text/javascript">
            var maxArraySize = 50;
            var u = new tvs.Annotator();
            u.annotateDocument();
		        //var pElem2 = $('#p2')[0];
            // Data to save
            var allSelected = [];
            var firstEssayRating;
            var allVisSelected = [];
            var secondEssayRating;

            //var $select2 = $('<select></select>'),
            var $body = $(document.body);
            var essay = document.getElementById("essay");
            var firstRated = false;
            // Hide subsequent sections
            var firstRateSection = document.getElementById("firstRate");
            firstRateSection.style.display = "none";
            var essayVisSection = document.getElementById("essayVis");
            essayVisSection.style.display = "none";
            var secondRateSection = document.getElementById("secondRate");
            secondRateSection.style.display = "none";
            var finishedSection = document.getElementById("finished");
            finishedSection.style.display = "none";

            //Checkbox has to be selected in order to rank the evidence
            var $checkBoxA = $('#optionA'),
                $checkBoxB = $('#optionB'),
                $checkBoxC = $('#optionC'),
                $checkBoxD = $('#optionD'),
                $checkBoxE = $('#optionE'),
                $checkBoxF = $('#optionF'),
                $checkBoxG = $('#optionG'),
                $checkBoxH = $('#optionH'),
                $selectA = $('#rankingA'),
                $selectB = $('#rankingB'),
                $selectC = $('#rankingC'),
                $selectD = $('#rankingD'),
                $selectE = $('#rankingE'),
                $selectF = $('#rankingF'),
                $selectG = $('#rankingG'),
                $selectH = $('#rankingH');
            $checkBoxA.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectA.removeAttr('disabled');
                }else{
                   $selectA.attr('disabled','disabled');
                }
            });
            $checkBoxB.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectB.removeAttr('disabled');
                }else{
                   $selectB.attr('disabled','disabled');
                }
            });
            $checkBoxC.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectC.removeAttr('disabled');
                }else{
                   $selectC.attr('disabled','disabled');
                }
            });
            $checkBoxD.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectD.removeAttr('disabled');
                }else{
                   $selectD.attr('disabled','disabled');
                }
            });
            $checkBoxE.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectE.removeAttr('disabled');
                }else{
                   $selectE.attr('disabled','disabled');
                }
            });
            $checkBoxF.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectF.removeAttr('disabled');
                }else{
                   $selectF.attr('disabled','disabled');
                }
            });
            $checkBoxG.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectG.removeAttr('disabled');
                }else{
                   $selectG.attr('disabled','disabled');
                }
            });
            $checkBoxH.on('change',function(e){
                if ($(this).is(':checked')){
                    $selectH.removeAttr('disabled');
                }else{
                   $selectH.attr('disabled','disabled');
                }
            });

            // Only 4 pieces of evidence can be selected at a time
            var limit = 4;
            $('input.evidenceSelection').on('change', function(evt) {
               if($("input[name='optionSelect']:checked").length > limit) {
                   this.checked = false;
               }
            });
            // Create buttons: Highlight text essay
            /*var highlightButton = document.createElement("button");
            var highlightButtonText = document.createTextNode("Highlight");
            highlightButton.appendChild(highlightButtonText);
            highlightButton.setAttribute("id", "highlightButton");
            essay.appendChild(highlightButton);*/

            // Create button: next button after highlight is done
            var nextButtonRate = document.createElement("button");
            var nextButtonText = document.createTextNode("Submit");
            nextButtonRate.appendChild(nextButtonText);
            nextButtonRate.setAttribute("id", "submitEssayHighlight");
            document.getElementById("continue").appendChild(nextButtonRate)
            //nextButtonRate.onclick = rateEssay;


            // Create button: next button after rating is selected
            var ratingSubmitButton = document.createElement("button");
            var ratingSubmitButtonText = document.createTextNode("Submit Rating");
            ratingSubmitButton.appendChild(ratingSubmitButtonText);
            ratingSubmitButton.setAttribute("id", "submitFirstRating");
            document.getElementById("firstRate").appendChild(ratingSubmitButton)
            ratingSubmitButton.onclick = submitFirstEssayRating;


            // Create buttons: Highlight essay vis
            /*
            var highlightButtonVis = document.createElement("button");
            var highlightButtonVisText = document.createTextNode("Highlight");
            highlightButtonVis.appendChild(highlightButtonVisText);
            highlightButtonVis.setAttribute("id", "highlightButtonVis2");
            essayVisSection.appendChild(highlightButtonVis);*/


            // Create button: Essay vis continue button
            var nextButtonRate2 = document.createElement("button");
            var nextButtonText2 = document.createTextNode("Continue");
            nextButtonRate2.appendChild(nextButtonText2);
            nextButtonRate2.setAttribute("id", "submitEssayHighlight2");
            essayVisSection.appendChild(nextButtonRate2)
            nextButtonRate2.onclick = rateEssayVis;

            // Create button: next button after rating is selected
            var ratingSubmitButton2 = document.createElement("button");
            var ratingSubmitButtonText2 = document.createTextNode("Submit Rating");
            ratingSubmitButton2.appendChild(ratingSubmitButtonText2);
            ratingSubmitButton2.setAttribute("id", "submitSecondRating");
            document.getElementById("secondRate").appendChild(ratingSubmitButton2)
            ratingSubmitButton2.onclick = submitSecondEssayRating;
            /*
            function createCtrl2(title, clickHandler) {
              highlightButton.onclick = function() {
				            //getSelectionText();
                    //node.setAttribute("id", highlightCount.toString());
                    clickHandler.apply(u, ['solid', 'blue']);
              };
              highlightButtonVis.onclick = function() {
				            //getSelectionText();
                    //node.setAttribute("id", highlightCount.toString());
                    clickHandler.apply(u, ['solid', 'blue']);
              };

            }

            createCtrl2('highlight', u.highlightSelected);
            */
            //If the highlighted text is clicked on, it will be removed
            $body.on('click', '.tvs-annotated-text, .tvs-annotate-element', function(e) {
            u.unannotateElement(this);

				//get the ID of the highlighted text?
				//var listItemToRem = document.getElementById("mySelect");
				//x.remove(x.selectedIndex);
            });

            var highlightCount = 0;
      			function getSelectionText() {
      				var text = "";
      				if (window.getSelection) {
      					text = window.getSelection().toString();
      				} else if (document.selection && document.selection.type != "Control") {
      					text = document.selection.createRange().text;
      				}
      				highlightCount++;
      				//appendText(text, highlightCount);
              // add to an array of selected text
              allSelected.push(text);
              //console.log(allSelected);
      				//return text;
      			}

            // Process  the essay selection and switch to rating the student
            function rateEssay() {
              var firstRateSection = document.getElementById("firstRate");
              if (firstRateSection.style.display === "none") {
                firstRateSection.style.display = "block";
              }
              var essaySection = document.getElementById("essay");
              //var essayList = document.getElementById("essaySection");
              essaySection.style.display = "none";
              document.getElementById("continue").style.display = "none";
              //essayList.style.display = "none";

              // Remove and extract all annotations from essayList
              $(document).ready(function(){
                var allspans = $("#essay").find("span"); // get list of all annotation spans in essay
                //var allspans = essay.getElementsByClassName(".tvs-annotated-text, .tvs-annotate-element")
                console.log(allspans)
                var i;
                //Unannotate all and extract
                //$body.on('click', '.tvs-annotated-text, .tvs-annotate-element', function(e) {
                for (i = 0; i < allspans.length; i++) {
                  console.log(allspans[i].innerHTML);
                  allSelected.push(allspans[i].innerHTML);
                  u.unannotateElement(allspans[i]);
                  //allspans[i].onclick = function() { console.log('we did it'); };

                  //$("div").find("span").css({"color": "red", "border": "2px solid red"});
                }
              });

            }

            function rateEssayVis() {
              if (secondRateSection.style.display === "none") {
                secondRateSection.style.display = "block";
              }
              essayVisSection.style.display = "none";
              document.getElementById("continue").style.display = "none";

              // Remove and extract all annotations from essayList
              $(document).ready(function(){
                var allspans = $("#essayVis").find("span"); // get list of all annotation spans in essay
                //var allspans = essay.getElementsByClassName(".tvs-annotated-text, .tvs-annotate-element")
                console.log(allspans)
                var i;
                //Unannotate all and extract
                //$body.on('click', '.tvs-annotated-text, .tvs-annotate-element', function(e) {
                for (i = 0; i < allspans.length; i++) {
                  console.log(allspans[i].innerHTML);
                  allVisSelected.push(allspans[i].innerHTML);
                  u.unannotateElement(allspans[i]);
                  //allspans[i].onclick = function() { console.log('we did it'); };

                  //$("div").find("span").css({"color": "red", "border": "2px solid red"});
                }
              });

            }

            function submitFirstEssayRating() {
              var radios = document.getElementsByName('firstRatingRadio');
              // Get the value of the rating
              for (var i = 0, length = radios.length; i < length; i++) {
               if (radios[i].checked) {
                essayRating = radios[i].value;
                // only one radio can be logically checked, don't check the rest
               }
             }

              // No need to check if a rating has been selected since it's required in HTML
                firstRateSection.style.display = "none";
                essayVis.style.display = "block";
                firstRated = true;
            }


            function submitSecondEssayRating() {
              var radios = document.getElementsByName('secondRatingRadio');
              // Get the value of the rating
              for (var i = 0, length = radios.length; i < length; i++) {
               if (radios[i].checked) {
                essayRating = radios[i].value;
                // only one radio can be logically checked, don't check the rest
               }
              }
                //Go to end
                secondRateSection.style.display = "none";
                finishedSection.style.display = "block";

                //TO DO: Extract data
                //firstRated = true;


            }

      			/*function appendText(highlightedText, highlightCount) {
      				var node = document.createElement("LI");                 // Create a <li> node
      				node.setAttribute("id", highlightCount.toString());
      				var textnode = document.createTextNode(highlightedText);         // Create a text node
      				node.appendChild(textnode);                              // Append the text to <li>
      				document.getElementById("essayList").appendChild(node);     // Append <li> to <ul> with id="myList"
      			}*/
            var evidence = ['bad grammar', 'good vocabulary']
            function showEvidence(spanInput) {
              var evidenceNum = spanInput.id.toString();
              var thisEvidence = evidence[evidenceNum];
              console.log(thisEvidence)


            }

            function hideEvidence(spanInput) {
              console.log(spanInput)
            }


        </script>



	</body>
</html>
